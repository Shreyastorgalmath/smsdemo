<!DOCTYPE html>
<html>
<head>
  <title>SMS Magic - Conversive - Higher Education - Human+Automation+AI</title>
  <link rel="icon" type="image/svg" href="smsmagic.svg">
  <style>
    /* Desktop and Mobile Images */
    .image-container {
      text-align: center;
    }
    .desktop-image {
      display: block;
      width: 100%;
    }
    .mobile-image {
      display: none;
    }
    @media screen and (max-width: 768px) {
      .desktop-image {
        display: none;
      }
      .mobile-image {
        display: block;
        width: 100%;
      }
    }
    /* Button Styles */
    .action-button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 10px 20px;
      text-align: center;
      text-decoration: none;
      display: block;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
    }
    .image-container {
      text-align: center;
      position: relative;
    }
    .button-container {
      position: absolute;
      left: 20px;
      bottom: 20px;
      z-index: 5;
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      background-color: green;
      color: white;
      border: 1px solid black;
      border-radius: 4px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      z-index: 10; /* Ensures modal appears above everything */
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9; /* Ensures it is behind the modal but above the page */
    }
  </style>
</head>
<body>
  <div class="image-container">
    <!-- Your images would go here -->
    <div class="button-container">
      <button class="action-button" onclick="resetConversation()">Reset Conversation</button>
    </div>
  </div>

  <!-- Modal -->
  <div id="myModal" class="modal">
    <p id="modalMessage">Action completed successfully!</p>
  </div>
  <div id="overlay" class="overlay"></div>

  <script>
    function resetConversation() {
      try {
        // Clear specific conversation storage
        const conversationKeys = [];
        // Find all keys in localStorage that might be related to the conversation
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && (
              key.includes('conversation') || 
              key.includes('chat') || 
              key.includes('message') ||
              key.includes('txtbox') ||
              key.includes('sms-magic')
            )) {
            conversationKeys.push(key);
          }
        }
        
        // Remove all identified conversation keys
        conversationKeys.forEach(key => localStorage.removeItem(key));
        
        // For cookies, only remove conversation-related cookies
        document.cookie.split(";").forEach(function(cookie) {
          var eqPos = cookie.indexOf("=");
          var name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
          if (name && (
              name.includes('conversation') || 
              name.includes('chat') || 
              name.includes('message') ||
              name.includes('txtbox') ||
              name.includes('sms-magic')
            )) {
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
          }
        });
        
        // If the chatbot has a global reset function, call it
        if (typeof window.resetChatBot === 'function') {
          window.resetChatBot();
        }
        
        showModal("Conversation reset successfully! Page will reload shortly.");
        
        // Refresh just the chatbot if possible, otherwise reload the page
        if (document.querySelector('.conversive-chatbot-container')) {
          // If there's an iframe within the chatbot container, refresh it
          const chatbotFrame = document.querySelector('.conversive-chatbot-container iframe');
          if (chatbotFrame) {
            chatbotFrame.src = chatbotFrame.src;
          } else {
            // Otherwise reload the whole page
            setTimeout(() => location.reload(), 1000);
          }
        } else {
          setTimeout(() => location.reload(), 1000);
        }
      } catch (error) {
        console.error("Error resetting conversation:", error);
        showModal("Error resetting conversation. Please try again.");
      }
    }

    function showModal(message) {
      var modal = document.getElementById("myModal");
      var overlay = document.getElementById("overlay");
      document.getElementById("modalMessage").innerText = message;
      modal.style.display = "block";
      overlay.style.display = "block";
    }
  </script>

  <script type="text/javascript">
    (async function() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            let e = urlParams.get('btn');
            const env = urlParams.get('env');
            let w, a;
            if (env === 'qa') {
                w = "qa-api.txtbox.in";
                a = "https://qa-app.txtbox.in";
            } else if (env === "stg") {
                w = "api.txtbox.in";
                a = "https://app.txtbox.in";
            } else if (env === "us") {
                w = "api.sms-magic.com";
                a = "https://app.sms-magic.com";
            } else if (env === "eu") {
                w = "eu.api.sms-magic.com";
                a = "https://eu.app.sms-magic.com";
            } else if (env === "aus") {
                w = "aus-api.sms-magic.com";
                a = "https://aus-app.sms-magic.com";
            } else if (env === "int") {
                w = "dev-api.txtbox.in";
                a = "https://dev-app.txtbox.in";
            }
            else{
              w = "aus-api.sms-magic.com";
              a = "https://aus-app.sms-magic.com";
              e = "92d361c2-0b65-4528-a45a-7734f6aafca6";
            }
            let o = "";
            let n = "";
            let c = "";
            const i = 3000;
            const d = "https://das-dev.deepalgorithms.io";
            async function t() {
                o = a + "/v1/conversive/button/run/" + e + "?latitude=" + n + "&longitude=" + c;
                let t = await fetch(o).then((t => t.json())).then((t => t)).catch((t => {}));
                if ("success" === t.response.status) {
                    let e = t.response;
                    if (document.getElementById(e.data.button_config.scriptLocation)) displayButton(e.data);
                    else {
                        const t = document.getElementsByTagName("head")[0];
                        const a = document.createElement("link");
                        const o = document.createElement("script");
                        const n = document.createElement("link");
                        const c = document.createElement("script");
                        a.rel = "stylesheet";
                        a.type = "text/css";
                        a.href = e.data.button_config.cssLocation;
                        a.onload = () => {
                            t.appendChild(o);
                        };
                        t.appendChild(a);
                        o.type = "text/javascript";
                        o.id = e.data.button_config.scriptLocation;
                        o.src = e.data.button_config.scriptLocation;
                        o.onload = () => {
                            displayButton(e.data);
                        };
                        n.rel = "stylesheet";
                        n.type = "text/css";
                        c.id = e.data.chatbot_config.chatbotCSS;
                        n.href = e.data.chatbot_config.chatbotCSS;
                        n.onload = () => {
                            t.appendChild(c);
                        };
                        t.appendChild(n);
                        c.type = "text/javascript";
                        c.id = e.data.chatbot_config.chatbotJS;
                        c.src = e.data.chatbot_config.chatbotJS;
                        c.onload = () => {
                            loadChatBot(d, w, e.data);
                            
                            // Expose a global reset function that external buttons can call
                            window.resetChatBot = function() {
                                // If the chatbot has an internal reset method, try to call it
                                try {
                                    if (window.conversiveChat && typeof window.conversiveChat.reset === 'function') {
                                        window.conversiveChat.reset();
                                        return true;
                                    }
                                } catch (e) {
                                    console.error("Failed to reset chatbot:", e);
                                }
                                return false;
                            };
                        };
                    }
                }
            }
            navigator.geolocation && navigator.geolocation.getCurrentPosition((e) => {
                n = e.coords.latitude;
                c = e.coords.longitude;
                t();
            }, (e) => {
                t();
            }, {
                timeout: i
            });
            setTimeout(t, i);
        } catch (s) {}
    })();
  </script>
</body>
</html>
